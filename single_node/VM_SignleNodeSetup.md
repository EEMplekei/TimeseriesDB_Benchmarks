# VM Single Node Setup:


## VM Specs:
- Ubuntu 22.04 Jammy Cloud
- 8 CPUs
- 16Gb Ram
- 30Gb Disk

GsGLKgki5V

## Installation and Setup Procces

### Updating

```
sudo apt update
sudo apt upgrade
```

To any popups we select OK
```
reboot
```
	
Now the kernel is version linux 5.15.0-89-generic
	
### Install InfluxDB
Source -> https://medium.com/yavar/install-and-setup-influxdb-on-ubuntu-20-04-22-04-3d6e090ec70c)
		
```
sudo apt update
```

```
wget -q https://repos.influxdata.com/influxdata-archive_compat.key
```

```
echo '393e8779c89ac8d958f81f942f9ad7fb82a25e133faddaf92e15b16e6ac9ce4c influxdata-archive_compat.key' | sha256sum -c && cat influxdata-archive_compat.key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg > /dev/null
```

```
echo 'deb [signed-by=/etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg] https://repos.influxdata.com/debian stable main' | sudo tee /etc/apt/sources.list.d/influxdata.list
```

```
sudo apt update
```

```
sudo apt install influxdb2
```

```
sudo systemctl start influxdb
```

```
sudo systemctl enable influxdb
```

```
sudo ufw allow 8086/tcp
```
		
Now we are able to access the influxDB UI through port 8086 and using the systems public IP address (or domain)
We set up username and password:
- Username: influxDB
- Password: m01g48p96
- Organization: NTUA
- Initial Bucket Name: system
- API Token: 

### Install PostgressDB:
Source -> https://docs.timescale.com/self-hosted/latest/install/installation-linux/

```
apt install gnupg postgresql-common apt-transport-https lsb-release wget
```

```
sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
```

Press Enter

```
echo "deb https://packagecloud.io/timescale/timescaledb/ubuntu/ $(lsb_release -c -s) main" | sudo tee /etc/apt/sources.list.d/timescaledb.list
```


```
wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg
```

```
sudo apt update
sudo apt upgrade
```

```
sudo apt install timescaledb-2-postgresql-14
```

```
sudo timescaledb-tune --quiet --yes
```

```
sudo -i -u postgres
psql
CREATE EXTENSION IF NOT EXISTS timescaledb;
ALTER USER postgres WITH PASSWORD 'password';
```

### Install Golang:
```
sudo apt update
sudo apt install golang-go
```
		
### Install TSBS:
```
sudo apt install make
```

```
sudo apt install golang-golang-x-tools
```

```
go install github.com/timescale/tsbs@latest
```

```
cd go/pkg/mod/github.com/timescale/tsbs@v0.0.0-20230921131859-37fced794d56/
```

```
sudo make all
```


```
echo "export PATH=$PATH:~/go/pkg/mod/github.com/timescale/tsbs@v0.0.0-20230921131859-37fced794d56/bin" >> ~/.profile
```

```
source ~/.profile
```

### Install pip3 and plotext

```
which python3 (sudo apt install python3)
sudo apt-get -y install python3-pip
pip3 install plotext
```

### Generate Data:
```
cd ~/data_generate
```

```
bash data_timescale_small.sh
bash data_timescale_medium.sh
bash data_timescale_large.sh
bash data_influx_small.sh
bash data_influx_medium.sh
bash data_influx_large.sh
```

Now the data is in the ~/iot_data folder
		
#### Load data into DBs:
The scripts for loading the data to the databases are in the ~/data_load folder.

We have to create the folder to store the benchmarkings of the insertion phase.
```
mkdir performance; cd performance; mkdir write; cd write;
```

###### Load into Timescale:
To insert the data (once generated) to timescaledb do the following:

```
cd ~/data_load
```
```
bash load_timescaledb.sh data_timescale_small.dat.gz small >> ~/performance/write/timescale_small.out
```
```
bash load_timescaledb.sh data_timescale_medium.dat.gz medium >> ~/performance/write/timescale_medium.out
```
```
bash load_timescaledb.sh data_timescale_large.dat.gz large >> ~/performance/write/timescale_large.out
```

###### Load into InfluxDB:

```
cd ~/data_load
```
```
bash load_influx.sh data_influx_small.dat.gz small >> ~/performance/write/influx_small.out
```
```
bash load_influx.sh data_influx_medium.dat.gz medium >> ~/performance/write/influx_medium.out
```
```
bash load_influx.sh data_influx_large.dat.gz large >> ~/performance/write/influx_large.out
```
#### Query Generation Proccess:

We will generate the following queries
- Single queries
- Repetitive queries (100)
- Repetitive queries (1000)

##### Single Query Generation Proccess:
The following command will generate single queries for both influx and timescaledb for every dataset size.
```
cd ~/queries_generate
bash generate_query_single.sh
```

#### Query Execution Proccess:
Scripts for this proccess is in the /query_execution folder. There are 2 scripts (one for timescaledb and one for influx) to run the queries that have already been generated by the previous proccess.

##### Single Query Execution Proccess:
Run the following commands to run all the single queries for all datasets.
```
cd ~/queries_execution
bash run_queries_timescale.sh single small
bash run_queries_timescale.sh single medium
bash run_queries_timescale.sh single large
bash run_queries_influx.sh single small
bash run_queries_influx.sh single medium
bash run_queries_influx.sh single large
```
The result of these commands will be in ~/performance/queries.