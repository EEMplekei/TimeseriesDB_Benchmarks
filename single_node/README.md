# Single Node Setup:


## VM Specs:
- Ubuntu 22.04 Jammy Cloud
- 8 CPUs
- 16Gb Ram
- 30Gb Disk

GsGLKgki5V

## Installation and Setup Procces

### Updating

```
sudo apt update
sudo apt upgrade
```

To any popups we select OK
```
reboot
```
	
Now the kernel is version linux 5.15.0-89-generic
	
### Install InfluxDB
Source -> https://docs.influxdata.com/influxdb/v1/introduction/install/
		
```
wget -q https://repos.influxdata.com/influxdata-archive_compat.key
echo '393e8779c89ac8d958f81f942f9ad7fb82a25e133faddaf92e15b16e6ac9ce4c influxdata-archive_compat.key' | sha256sum -c && cat influxdata-archive_compat.key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg > /dev/null
echo 'deb [signed-by=/etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg] https://repos.influxdata.com/debian stable main' | sudo tee /etc/apt/sources.list.d/influxdata.list
```

```
sudo apt-get update && sudo apt-get install influxdb
sudo service influxdb start
```

### Install PostgressDB:
Source -> https://docs.timescale.com/self-hosted/latest/install/installation-linux/

```
apt install gnupg postgresql-common apt-transport-https lsb-release wget
```

```
sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
```

Press Enter

```
echo "deb https://packagecloud.io/timescale/timescaledb/ubuntu/ $(lsb_release -c -s) main" | sudo tee /etc/apt/sources.list.d/timescaledb.list
```


```
wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg
```

```
sudo apt update
sudo apt upgrade
```

```
sudo apt install timescaledb-2-postgresql-14
```

```
sudo timescaledb-tune --quiet --yes
```

```
sudo -i -u postgres
psql
CREATE EXTENSION IF NOT EXISTS timescaledb;
ALTER USER postgres WITH PASSWORD 'password';
```

### Install Golang:
```
sudo apt update
sudo apt install golang-go
```
		
### Install TSBS:
```
sudo apt install make
```

```
sudo apt install golang-golang-x-tools
```

```
go install github.com/timescale/tsbs@latest
```

```
cd go/pkg/mod/github.com/timescale/tsbs@v0.0.0-20230921131859-37fced794d56/
```

```
sudo make all
```


```
echo "export PATH=$PATH:~/go/pkg/mod/github.com/timescale/tsbs@v0.0.0-20230921131859-37fced794d56/bin" >> ~/.profile
```

```
source ~/.profile
```

### Install pip3 and plotext

```
which python3 (sudo apt install python3)
sudo apt-get -y install python3-pip
pip3 install plotext
```

### Generate Data:
```
cd ~/TimeseriesDB_Benchmarks/single_node/data_generate
bash data_generate.sh
```

Now the data is in the ~/TimeseriesDB_Benchmarks/single_node/iot_data folder
		
#### Load data into DBs:
The scripts for loading the data to the databases are in the ~/TimeseriesDB_Benchmarks/single_node/data_load folder.

We have to create the folder to store the benchmarkings of the insertion phase.
```
mkdir performance; cd performance; mkdir write; cd write;
```

###### Load into Timescale:
To insert the data (once generated) to timescaledb do the following:

```
cd ~/TimeseriesDB_Benchmarks/single_node/data_load
```
```
bash load_timescaledb.sh small
```
```
bash load_timescaledb.sh medium
```
```
bash load_timescaledb.sh large
```

###### Load into InfluxDB:

```
cd ~/TimeseriesDB_Benchmarks/single_node/data_load
```
```
bash load_influx.sh small
```
```
bash load_influx.sh medium 
```
```
bash load_influx.sh large
```
#### Query Generation Proccess:

We will generate the following queries
- Single queries
- Repetitive queries (100)
- Repetitive queries (1000)

##### Single Query Generation Proccess:
The following command will generate single queries for both influx and timescaledb for every dataset size.
```
cd ~/TimeseriesDB_Benchmarks/single_node/queries_generate
bash generate_queries_all.sh
```

#### Query Execution Proccess:
Scripts for this proccess is in the /query_execution folder. There are 2 scripts (one for timescaledb and one for influx) to run the queries that have already been generated by the previous proccess.

##### Single Query Execution Proccess:
Run the following commands to run all the single queries for all datasets.
```
cd ~/TimeseriesDB_Benchmarks/single_node/queries_execution
bash run_queries_timescale.sh single small
bash run_queries_timescale.sh single medium
bash run_queries_timescale.sh single large
bash run_queries_influx.sh single small
bash run_queries_influx.sh single medium
bash run_queries_influx.sh single large
```
The result of these commands will be in ~/TimeseriesDB_Benchmarks/single_node/performance/queries.
